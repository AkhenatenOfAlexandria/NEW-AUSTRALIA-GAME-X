local tilemap = {}

local getTile = function (self, x, y, tileSize)
    local i = (math.floor(x / tileSize) + math.floor(y / tileSize) * self.tilesWide) + 1

    self.lastGotTile = i

    return self.map:sub(i,i)
end

local draw = function (self, view, tilesheet)
    for i = 1, #self.map do
        local char = self.map:sub(i,i)
        local x = ((i-1) % self.tilesWide) * tilesheet.tileSize
        local y = (math.floor((i-1) / self.tilesWide)) * tilesheet.tileSize

        if char == "x" then tilesheet:drawTile(view, x, y, 1, 1) end
        if char == "." then tilesheet:drawTile(view, x, y, 4, 1) end
        if char == "^" then tilesheet:drawTile(view, x, y, 3, 1) end
        if char == "=" then tilesheet:drawTile(view, x, y, 1, 2) end
        if char == "," then tilesheet:drawTile(view, x, y, 2, 1) end

        if DEBUG and i == self.lastGotTile then
            view:inContext(function ()
            love.graphics.rectangle("line", x, y, tilesheet.tileSize, tilesheet.tileSize)
            end)
        end
    end
end

tilemap.create = function ()
    local instance = {}

    instance.tilesWide = 240
    instance.tilesHigh = 135
    instance.lastGotTile = 0
    
    local map = [[
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
        xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
        xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
        ================================================================================================================================================================================================================================================
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        xx...........xxxxxxxxxxxxx..............................................................,......................................................................................................................................................x
        x............................................................................,.................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x................,.............................................................................................................................................................................................................................x
        x................,.............................................................................................................................................................................................................................x
        x................,.........................,...................................................................................................................................................................................................x
        x................,.............................................................................................................................................................................................................................x
        x................,.............................................................................................................................................................................................................................x
        x................,.............................................................................................................................................................................................................................x
        x................,,,,..............................................................................................................,...........................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..........................................,...................................................................................................................................................................................................x
        x..................................................................,...........................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x....................,..................................................................,......................................................................................................................................................x
        x........................................................................................................................................,.....................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................,...............................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x.......................................................................................,......................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x............................................................................................................,.................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..................................................................................................................................................................................,...........................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x...................................................................................................................................,..........................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x.............................................................................................................................................................,................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..................................................................................................,...........................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        x..............................................................................................................................................................................................................................................x
        xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
        ]]

        local whitespace = "%s"
        local nothing = ""
        instance.map = map:gsub(whitespace, nothing)
        instance.draw = draw
        instance.getTile = getTile

    return instance
end

return tilemap